---
layout: post
title:  "Build a Cli Gem"
date:   2016-09-15
categories: Ruby, CLI, Data, Gem
---

I plan to build a Cli Gem to scrape data for Apartment for rent listings here in NYC. One of the site I attempted to grab data from was Craigslist. Everything went well until I saw this: ![A search for craigslist scraper]({{ site.url }}/assets/screenshot.png) After seeing this in the search result, I decided to look for another website. 

Lets get started. Assuming you have [Ruby](https://www.ruby-lang.org/en/downloads/) and [RVM](https://rvm.io/rvm/install) installed on your system.

To check if you have the following installed, run the commands in terminal:

* `ruby -v` Check for Ruby version(s)

* `ruby 2.2.1p85 (2015-02-26 revision 49769) [x86_64-darwin14]`

* `rvm -v` Check the Ruby Version Manager

* `rvm gemset create <name>` creates a new [gemset](https://rvm.io/gemsets)
- `rvm gemset use <gemset name>` switchs over to the new gemset created
- `rvm gemset delete <gemset name>` if you need to delete

I named my gemset apt-finder

```
rvm gemset create apt-finder
ruby-2.2.1 - #gemset created /Users/nin/.rvm/gems/ruby-2.2.1@apt-finder
ruby-2.2.1 - #generating apt-finder wrappers........
```

to switch over and use the created gemset

`rvm gemset use apt-finder`

```
Using ruby-2.2.1 with gemset apt-finder
```

Now that we got that outof the way.

Next we will be using a gem called bundler to generate some files for this gem project, but first we will need to install the gem.

check to see if you have the gem installed 

`gem list`

if not, install the bundler gem by typing

`gem install bundler`

```
Fetching: bundler-1.13.1.gem (100%)
Successfully installed bundler-1.13.1
```

Lets use bundler to help generate some files for us.

<!-- Depending on your system, you may or may not be prompted with set up. -->

`bundler gem apt_finder`

```
Creating gem 'apt_finder'...
MIT License enabled in config
Code of conduct enabled in config
      create  apt_finder/Gemfile
      create  apt_finder/.gitignore
      create  apt_finder/lib/apt_finder.rb
      create  apt_finder/lib/apt_finder/version.rb
      create  apt_finder/apt_finder.gemspec
      create  apt_finder/Rakefile
      create  apt_finder/README.md
      create  apt_finder/bin/console
      create  apt_finder/bin/setup
      create  apt_finder/.travis.yml
      create  apt_finder/.rspec
      create  apt_finder/spec/spec_helper.rb
      create  apt_finder/spec/apt_finder_spec.rb
      create  apt_finder/LICENSE.txt
      create  apt_finder/CODE_OF_CONDUCT.md
Initializing git repo in /Users/nin/Development/code/apt_finder
```

change to the new directory

`cd apt_finder` 

create a new executable file in the bin directory

`cd bin` 

`touch apt-finder`

`apt-finder` is not setup with executable permission. to change this we need to change the permisson. 

`l`

```
total 24
drwxr-xr-x   5 nin  staff   170B Sep 13 14:01 .
drwxr-xr-x  15 nin  staff   510B Sep 13 13:54 ..
-rw-r--r--   1 nin  staff    28B Sep 13 14:02 apt-finder
-rwxr-xr-x   1 nin  staff   335B Sep 13 13:54 console
-rwxr-xr-x   1 nin  staff   131B Sep 13 13:54 setup
```

or

`ls -lah`

```
total 24
drwxr-xr-x   5 nin  staff   170B Sep 13 14:01 .
drwxr-xr-x  15 nin  staff   510B Sep 13 13:54 ..
-rw-r--r--   1 nin  staff    28B Sep 13 14:02 apt-finder
-rwxr-xr-x   1 nin  staff   335B Sep 13 13:54 console
-rwxr-xr-x   1 nin  staff   131B Sep 13 13:54 setup
```


`chmod +x apt-finder`

```
total 24
drwxr-xr-x   5 nin  staff   170B Sep 13 14:01 .
drwxr-xr-x  15 nin  staff   510B Sep 13 13:54 ..
-rwxr-xr-x   1 nin  staff    28B Sep 13 14:02 apt-finder
-rwxr-xr-x   1 nin  staff   335B Sep 13 13:54 console
-rwxr-xr-x   1 nin  staff   131B Sep 13 13:54 setup
``` 
open the file using a text editor of your choice. I am using sublime text. i am adding a puts statement in the file to test if we can read from that file.

`puts 'Welcome to Apt Finder'`

`./bin/apt-finder` 

```
./bin/apt-finder 
./bin/apt-finder: line 1: puts: command not found
```

we get this error because we did not tell our system how to process this file. 

Adding this line, tells the system to use the ruby interpeter

`#!/usr/bin/env ruby` 

lets try running that again
```
./bin/apt-finder 
Welcome to Apt Finder
```

Now we're all set up and ready to plan our program.

1. I will try to find a site that is easy for me to scrape 
2. what i would like is for a user to install this gem run the program by typing in apt-list
3. after the user types apt-list scrape the current list and display listings on the users screen.
4. give the user the option to select the listing by number and after selection shw the deatils of that listing
5. if number is not a valid option then prompt the user to type the valid options

Adding dependencies in gemspec
- nokogiri
- pry

```
require 'open-uri'
require 'nokogiri'
require 'pry'
```

Planning:
name of file "apt-for-rent-cli-gem ""
  - What I want the CLI to do
  - Allow users to execute the program by typing in apt-for-rent
  - greet user 
  - show a short list of available apartments
  - show a menu of option
    - ask user to select number from the number list 
      - show extra deatails about specific listing
    - show error message if number is invalid
    - end program when the user types exit
    - show list of option when user type list

  - Sources
    - where do i find the listings?
    - craigslist - read craiglist TOS
      - I copy some listings to store locally for testng purposes
    - http://www.apartmentfinder.com/
    - https://www.renthop.com/nyc-apartments-for-rent
    - http://www.nakedapartments.com/renter/listings/search
    - StreetEasy
    - http://www.brickunderground.com/blog/2012/01/8_best_websites_for_finding_a_no_fee_apt_in_new_york_city







